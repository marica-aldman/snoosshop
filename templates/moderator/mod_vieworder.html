{% extends "base.html" %}

{% block content %}

<!--orders-->
<!--active-->
<div class="container">
    <form method="POST">
        {% csrf_token %}
        <div>
            <div>
                <button type="submit" class='btn btn-primary' name="back" value="1">
                    Tillbaka
                </button>
            </div>
        </div>
    </form>

    <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="order" value="{{order.id}}"
        <div class="row border border-warning" >
            <h1>Order {{order.id}}</h1>
            <table class="table-striped table-hover w-100  mb-2">
                <tbody>
                    <tr>
                        <td>
                            Kundid
                        </td>
                        <td>
                            {{ theClient.id }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {% if theClientInfo.company %}
                                Kontaktperson
                            {% else %}
                                Namn
                            {% endif %}
                        </td>
                        <td>
                            {{ theClientInfo.first_name }} {{ theClientInfo.last_name }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            OrderID
                        </td>
                        <td>
                            {{ order.id }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Orderreferens
                        </td>
                        <td>
                            {{ order.ref_code }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Frakt
                        </td>
                        <td>
                            {{ order.freight }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Kupongkod
                        </td>
                        <td>
                            {% if hasCoupon %}
                            {{ coupon.code }}
                            {% else %}
                            ---
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Kupongsvärde
                        </td>
                        <td>
                            {% if hasCoupon %}
                            {{ coupon.amount }}
                            {% else %}
                            ---
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Totalpris
                        </td>
                        <td>
                            {{ order.total_price }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Betalad
                        </td>
                        <td>
                            {% if hasPayment %}
                            {{ payment.timestamp }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Betalat
                        </td>
                        <td>
                            {{ payment.amount }}
                            {% else %}
                            ---
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Leveransaddress
                        </td>
                        <td>
                            {{ shipping_address.street_address }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Faktureringsaddress
                        </td>
                        <td>
                            {{ billing_address.street_address }}
                        </td>
                    </tr>
                    {% if order.subscription_order and not order.being_delivered %}
                    
                    <tr>
                        <td>
                            Premunation startad
                        </td>
                        <td>
                            {{ subscription.start_date|date:"d m Y" }}
                        </td>
                    </tr>
                    
                    <tr>
                        <td>
                            Nästa utskick
                        </td>
                        <td>
                            {{ order.sub_out_date|date:"d m Y" }}
                        </td>
                    </tr>

                    {% else %}

                    <tr>
                        <td>
                            Beställd
                        </td>
                        <td>
                            {{ order.ordered_date|date:"d m Y"  }}
                        </td>
                    </tr>

                    {% endif %}
                    <tr>
                        <td>
                            Status
                        </td>
                        <td>
                            {% if order.being_delivered %}
                                Skickad
                            {% elif order.being_read %}
                                Packas
                            {% else %}
                                Inte hanterad
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Återbetalningbegärd
                        </td>
                        <td>
                            {% if order.refund_requested %}
                                Ja
                            {% else %}
                                Nej
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Återbetalningbeviljad
                        </td>
                        <td>
                            {% if order.refund_granted %}
                                Ja
                            {% else %}
                                Nej
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Markera hela ordern som returnerad
                        </td>
                        <td>
                            <input type="checkbox" name="OrderReturned" value="True">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Godkänn återbetalning av hela orddern
                        </td>
                        <td>
                            <input type="checkbox" name="PaybackApproved" value="True">
                        </td>
                    </tr>
                </tbody>
            </table>

        </div>

        <!--recently completed-->
        <div class="row border border-dark">
            <h1>Order delar</h1>
            <table class="table-striped table-hover w-100  mb-2">
                <thead>
                    <tr>
                        <th>
                            Vara
                        </th>
                        <th>
                            Mängd
                        </th>
                        <th>
                            Styckepris
                        </th>
                        <th>
                            Reapris
                        </th>
                        <th>
                            Totalpris
                        </th>
                        <th>
                            Skickad
                        </th>
                        <th>
                            Returnera varan
                        </th>
                        <th>
                            Bevilja återbetalning
                        </th>
                    </tr>
                </thead>
                <tbody>
            {% for item in orderItems %}
                    <tr>
                        <td>
                            {{ item.title }}
                        </td>
                        <td>
                            {{ item.quantity }}
                        </td>
                        <td>
                            {{ item.price }}
                        </td>
                        <td>
                            {{ item.discount_price }}
                        </td>
                        <td>
                            {{ item.total_price }}
                        </td>
                        <td>
                            {{ item.sent }}
                        </td>
                        <td>
                            <input type="checkbox" name="return{{ item.id }}" value="{{ item.id }}">
                        </td>
                        <td>
                            <input type="checkbox" name="payback{{ item.id }}" value="{{ item.id }}">
                        </td>
                    </tr>
            {% endfor %}
                </tbody>
            </table>
            <button type='submit' class='btn btn-primary' name="save" value="True">Spara</button>
        </div>
    </form>
</div>


{% endblock content %}
